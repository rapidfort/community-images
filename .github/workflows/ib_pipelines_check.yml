name: IB Pipelines Tracker

on:
  schedule:
  - cron: '0 0 * * *'

  workflow_dispatch:

permissions: read-all

jobs:
  pipeline_check:
    name: Image Pipeline Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Run Pipeline Check
        id: pipeline_check_step
        run: python3 ./scripts/ib_pipelines_check.py | tee ib_tracker_logs.txt | echo "::set-output name=workflow-status::${PIPESTATUS[0]}"

      - name: Check Workflow Status
        run: |
          if [[ "${{ steps.pipeline_check_step.outputs.workflow-status }}" != "0" ]]; then
            echo "Pipeline check failed."
            exit 1
          fi