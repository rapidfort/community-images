version: '2'

services:
  apache:
    image: httpd:2.4
    user: root
    volumes:
      - ./configs/index.html:/usr/local/apache2/htdocs/index.html
      - ./configs/server-configs/httpd1.conf:/usr/local/apache2//conf/httpd.conf
      - ./certs/server.crt:/etc/ssl/certs/server.crt
      - ./certs/server.key:/etc/ssl/private/server.key
    cap_add:
      - SYS_PTRACE    
    ports:
      - "0.0.0.0::80"
      - "0.0.0.0::443"
    command: |
             sed -i '/SSLCertificateFile.*snakeoil\.pem/c\SSLCertificateFile \/etc\/ssl\/certs\/server.crt' /etc/apache2/sites-available/default-ssl.conf
             sed -i '/SSLCertificateKeyFile.*snakeoil\.key/cSSLCertificateKeyFile /etc/ssl/private/server.key\' /etc/apache2/sites-available/default-ssl.conf
  
  apache-prefork-mpm:
    image: httpd:2.4
    user: root
    volumes:
      - ./configs/index.html:/usr/local/apache2/htdocs/index.html
      - ./configs/server-configs/httpd2.conf:/usr/local/apache2//conf/httpd.conf
    cap_add:
      - SYS_PTRACE    
    ports:
      - "0.0.0.0::80"
      - "0.0.0.0::443"
  apache-worker-mpm:
    image: httpd:2.4
    user: root
    volumes:
      - ./configs/index.html:/usr/local/apache2/htdocs/index.html
      - ./configs/server-configs/httpd3.conf:/usr/local/apache2//conf/httpd.conf
    cap_add:
      - SYS_PTRACE    
    ports:
      - "0.0.0.0::80"
      - "0.0.0.0::443"
