global
    maxconn 256
    spread-checks 3
    ca-base /etc/ssl/certs
    crt-base /etc/ssl/private
    tune.ssl.default-dh-param 2048
    ssl-default-bind-ciphers TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256
    ssl-default-bind-options ssl-min-ver TLSv1.3

defaults
    log global
    mode http
    option httplog
    timeout connect 10s
    timeout client 60s
    timeout server 60s

frontend quic-in
    bind *:443 ssl crt /etc/ssl/private/haproxy.pem alpn h3
    mode http
    timeout client 60s

    acl app1 path_end -i /app1
    acl app2 path_end -i /app2
    http-request deny if { path -i -m beg /admin }

    use_backend app1Servers if app1
    use_backend app2Servers if app2
    
    default_backend flask

backend app1Servers
    timeout connect 10s
    timeout server 10s
    mode http
    balance roundrobin
    server web1 python-flask-1:8080
    server web2 python-flask-2:8080

backend app2Servers
    timeout connect 10s
    timeout server 15s
    mode http
    balance roundrobin
    server web3 python-flask-3:8080
    server web4 python-flask-4:8080

backend flask
    timeout connect 10s
    timeout server 100s
    mode http
    balance roundrobin
    server web1 python-flask-1:8080
    server web2 python-flask-2:8080
    server web3 python-flask-3:8080
    server web4 python-flask-4:8080
