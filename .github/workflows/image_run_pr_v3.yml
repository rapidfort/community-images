
name: Image Creation PR Run

on:

  pull_request:
    branches:
    - main

  workflow_dispatch:

permissions: read-all

jobs:
  airflow:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py airflow airflow/airflow/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run airflow/airflow/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/airflow": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  airflow-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py airflow-ib airflow/airflow/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run airflow/airflow/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/airflow-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  apache:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py apache apache/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run apache/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/apache": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  apache-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py apache-ib apache/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run apache/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/apache2-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  apache-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py apache-official apache/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run apache/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/apache-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  argocd:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py argocd argocd/quay output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run argocd/quay


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/argocd": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  cassandra-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py cassandra-official cassandra/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run cassandra/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/cassandra-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  consul:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py consul consul/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run consul/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/consul": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  consul-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py consul-ib consul/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run consul/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/consul-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  consul-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py consul-official consul/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run consul/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/consul-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  couchdb:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py couchdb couchdb/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run couchdb/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/couchdb": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  couchdb-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py couchdb-ib couchdb/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run couchdb/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/couchdb_3-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  couchdb-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py couchdb-official couchdb/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run couchdb/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/couchdb-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  curl:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py curl curl/curlimages output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run curl/curlimages


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/curl": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  elasticsearch:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py elasticsearch elasticsearch/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run elasticsearch/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/elasticsearch": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  elasticsearch-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py elasticsearch-official elasticsearch/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run elasticsearch/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/elasticsearch-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  envoy:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py envoy envoy/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run envoy/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/envoy": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  envoy-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py envoy-official envoy/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run envoy/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/envoy-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  etcd:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py etcd etcd/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run etcd/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/etcd": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  etcd-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py etcd-ib etcd/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run etcd/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/etcd-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  fluent-bit:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py fluent-bit fluent-bit/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run fluent-bit/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/fluent-bit": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  fluent-bit-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py fluent-bit-ib fluent-bit/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run fluent-bit/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/fluent-bit-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  fluentd:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py fluentd fluentd/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run fluentd/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/fluentd": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  fluentd-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py fluentd-ib fluentd/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run fluentd/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/fluentd-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  fluentd-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py fluentd-official fluentd/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run fluentd/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/fluentd-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  ghost:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py ghost ghost/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run ghost/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/ghost": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  grafana-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py grafana-ib grafana/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run grafana/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/grafana-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  haproxy:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py haproxy haproxy/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run haproxy/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/haproxy": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  haproxy-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py haproxy-ib haproxy/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run haproxy/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/haproxy24-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  haproxy-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py haproxy-official haproxy/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run haproxy/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/haproxy-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  influxdb:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py influxdb influxdb/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run influxdb/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/influxdb": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  keycloak-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py keycloak-official keycloak/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run keycloak/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/keycloak-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  kibana-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py kibana-ib kibana/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run kibana/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/kibana-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  kong:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py kong kong/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run kong/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/kong": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  logstash-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py logstash-ib logstash/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run logstash/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/logstash-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mariadb:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mariadb mariadb/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mariadb/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mariadb": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mariadb-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mariadb-ib mariadb/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mariadb/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mariadb-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mariadb-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mariadb-official mariadb/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mariadb/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mariadb-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  memcached:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py memcached memcached/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run memcached/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/memcached": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  memcached-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py memcached-ib memcached/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run memcached/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/memcached-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  memcached-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py memcached-official memcached/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run memcached/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/memcached-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  microsoft-sql-server-2019-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py microsoft-sql-server-2019-ib microsoft-sql-server-2019/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run microsoft-sql-server-2019/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/microsoft-sql-server-2019-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mongodb:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mongodb mongodb/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mongodb/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mongodb": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mongodb-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mongodb-ib mongodb/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mongodb/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mongodb-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mongodb-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mongodb-official mongodb/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mongodb/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mongodb-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  moodle-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py moodle-ib moodle/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run moodle/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/moodle-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mysql:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mysql mysql/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mysql/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mysql": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mysql-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mysql-ib mysql/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mysql/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mysql8-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  mysql-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py mysql-official mysql/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run mysql/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/mysql-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nats:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nats nats/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nats/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nats": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nats-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nats-ib nats/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nats/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nats-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nats-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nats-official nats/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nats/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nats-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nginx:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nginx nginx/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nginx/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nginx": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nginx-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nginx-ib nginx/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nginx/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nginx-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nginx-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nginx-official nginx/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nginx/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nginx-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  nifi-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py nifi-ib nifi/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run nifi/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/nifi-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  node-exporter:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py node-exporter node-exporter/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run node-exporter/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/node-exporter": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  node-exporter-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py node-exporter-ib node-exporter/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run node-exporter/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/node-exporter-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  oncall:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py oncall oncall/grafana output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run oncall/grafana


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/oncall": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  pause-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py pause-ib pause/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run pause/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/pause-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  postgresql:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py postgresql postgresql/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run postgresql/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/postgresql": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  postgresql-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py postgresql-ib postgresql/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run postgresql/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/postgresql12-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  postgresql-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py postgresql-official postgresql/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run postgresql/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/postgresql-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  prometheus:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py prometheus prometheus/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run prometheus/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/prometheus": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  prometheus-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py prometheus-ib prometheus/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run prometheus/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/prometheus-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  rabbitmq:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py rabbitmq rabbitmq/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run rabbitmq/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/rabbitmq": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  redis:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py redis redis/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run redis/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/redis": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  redis-cluster:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py redis-cluster redis-cluster/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run redis-cluster/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/redis-cluster": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  redis-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py redis-ib redis/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run redis/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/redis6-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  redis-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py redis-official redis/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run redis/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/redis-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  telegraf:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py telegraf telegraf/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run telegraf/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/telegraf": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  terraform-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py terraform-ib terraform/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run terraform/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/terraform-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  traefik:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py traefik traefik/traefik output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run traefik/traefik


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/traefik": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  traefik-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py traefik-ib traefik/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run traefik/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/traefik-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  vault:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py vault vault/hashicorp output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run vault/hashicorp


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/vault": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  vault-k8s-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py vault-k8s-ib vault-k8s/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run vault-k8s/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/vault-k8s-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  wordpress:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py wordpress wordpress/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run wordpress/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/wordpress": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  wordpress-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py wordpress-ib wordpress/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run wordpress/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/wordpress-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  yourls:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py yourls yourls/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run yourls/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/yourls": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  zookeeper:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py zookeeper zookeeper/bitnami output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run zookeeper/bitnami


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/zookeeper": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  zookeeper-ib:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py zookeeper-ib zookeeper/ironbank output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run zookeeper/ironbank


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/zookeeper-ib": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
  zookeeper-official:
    runs-on: ubuntu-latest

    environment: actions-cicd-pr

    steps:
      - uses: actions/checkout@v4


      - name: Check if test required
        id: test-required
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 scripts/tests_required.py zookeeper-official zookeeper/official output.txt
          cat output.txt >> $GITHUB_OUTPUT

      - name: Start minikube

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        with:
          memory: 6g
        uses: medyagh/setup-minikube@master
      - name: Check k8s cluster !

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: kubectl get pods -A
      - name: Setup ubuntu
        env:
          RF_ACCESS_ID: ${{ secrets.RF_ACCESS_ID }}
          RF_SECRET_ACCESS_KEY: ${{ secrets.RF_SECRET_ACCESS_KEY }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RF_PLATFORM_HOST: ${{ secrets.RF_PLATFORM_HOST }}
          RF_APP_HOST: ${{ secrets.RF_APP_HOST }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: ./scripts/setup.sh

      - name: Set RF CLI Path
        run: echo "/usr/local/rapidfort_cli" >> $GITHUB_PATH


      - name: Create images for testing PR
        env:
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
          DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}
          RAPIDFORT_ACCOUNT: ${{ secrets.RAPIDFORT_ACCOUNT }}
          IB_DOCKER_USERNAME: ${{ secrets.IB_DOCKER_USERNAME }}
          IB_DOCKER_PASSWORD: ${{ secrets.IB_DOCKER_PASSWORD }}
        if: ${{ steps.test-required.outputs.TEST_REQUIRED == 'yes' }}
        run: python3 community_images/common/orchestrator/main.py hourly_run zookeeper/official


      - name: Report pulls
        env:
          PULL_COUNTER_MAGIC_TOKEN: ${{ secrets.PULL_COUNTER_MAGIC_TOKEN }}

        if: ${{ github.event_name == 'pull_request' && steps.test-required.outputs.TEST_REQUIRED == 'yes' }}

        run: |
          curl -X POST \
           -H "Accept: application/json" \
           -H "Authorization: Bearer ${PULL_COUNTER_MAGIC_TOKEN}" \
           -d '{ "rapidfort/zookeeper-official": 1 }' \
           https://data-receiver.rapidfort.com/counts/internal_image_pulls
